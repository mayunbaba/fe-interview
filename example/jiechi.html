<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <div id="app">
    <h4>已经实现的功能，数据修改更新页面数据。</h4>
    <h4>目前数据和对应的DOM之间关系靠硬编码实现，所以引入发布订阅者模式解决这个问题。</h4>
    <input type="text" v-model="message">
  </div>
  <!-- <script src="/docs/vue/vue/defineProperty.js"></script>
  <script src="/docs/vue/vue/proxy.js"></script> -->
  <script>
    // 创建一个递归代理函数，用于代理整个数据对象
    function createProxy(data, updateCallback) {
      if (typeof data !== 'object' || data === null) {
        return data;
      }

      return new Proxy(data, {
        get(target, key) {
          return createProxy(target[key], updateCallback);
        },
        set(target, key, value) {
          target[key] = value;
          // 触发更新回调
          updateCallback();
          return true;
        }
      });
    }

    class Vue {
      constructor(options) {
        this.$data = options.data;
        this.$el = document.querySelector(options.el);
        this.proxyData();

        // 初始化视图
        this.render();
      }

      proxyData() {
        // 使用Proxy代理data对象
        this.$data = createProxy(this.$data, () => {
          this.render();
        });
      }

      render() {
        // 更新视图
        const input = this.$el.querySelector('input');
        input.value = this.$data.message.detail;
      }
    }

    // 实例化Vue
    const vm = new Vue({
      el: '#app',
      data: {
        message: {
          detail: '第一次的数据'
        },
      }
    });
    vm.$data.message.detail = 'js修改的数据';

  </script>
</body>

</html>